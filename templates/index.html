<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide icons -->
    <script src="https://unpkg.com/lucide-react@latest/dist/lucide.js"></script>

    <!-- Load Showdown.js to render Markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
      <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* (Spinner and scrollbar styles remain the same) */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Styles for AI-generated content */
        .ai-content {
            border-left: 4px solid #4f46e5; /* indigo-600 */
            padding-left: 1rem;
            margin-top: 1rem;
            background-color: #f9fafb; /* gray-50 */
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .ai-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            line-height: 1.75;
        }
        .ai-content p {
            margin-bottom: 0.5rem;
            line-height: 1.75;
        }
        .ai-content strong {
            color: #1f2937; /* gray-800 */
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <!-- This flex container is the main layout wrapper -->
    <div class="flex h-screen bg-gray-100">

        <!-- Sidebar (Visible on medium screens and up) -->
        <aside class="hidden md:flex md:flex-shrink-0 w-64 flex-col bg-gray-800 text-white">
            <div class="flex flex-col flex-grow">
                <!-- Sidebar Header/Logo -->
                <div class="flex items-center h-16 flex-shrink-0 px-6 bg-gray-900">
                    <i data-lucide="scan-line" class="h-8 w-8 text-indigo-400"></i>
                    <span class="ml-3 text-xl font-semibold">AI Resume Pro</span>
                </div>
                
                <!-- Navigation Links -->
                <nav class="flex-1 px-4 py-4 space-y-2">
                    <a href="#" class="flex items-center px-4 py-3 rounded-lg bg-gray-700 text-white">
                        <i data-lucide="layout-dashboard" class="h-5 w-5 mr-3"></i>
                        Dashboard
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white">
                        <i data-lucide="user-circle" class="h-5 w-5 mr-3"></i>
                        Profile
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white">
                        <i data-lucide="settings" class="h-5 w-5 mr-3"></i>
                        Settings
                    </a>
                </nav>
            </div>
            
            <!-- User Profile Section at Bottom -->
            <div class="flex-shrink-0 p-4 border-t border-gray-700">
                <a href="#" class="flex items-center group">
                    <img class="h-10 w-10 rounded-full" src="https://placehold.co/100x100/6366f1/white?text=User" alt="User Avatar">
                    <div class="ml-3">
                        <p class="text-sm font-medium text-white">Jane Doe</p>
                        <p class="text-xs font-medium text-gray-400 group-hover:text-gray-300">View Profile</p>
                    </div>
                </a>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
            
            <!-- Mobile Header (Visible on small screens) -->
            <header class="md:hidden flex items-center justify-between h-16 bg-white border-b border-gray-200 px-4">
                <div class="flex items-center">
                    <i data-lucide="scan-line" class="h-7 w-7 text-indigo-600"></i>
                    <span class="ml-2 text-lg font-semibold text-gray-800">AI Resume Pro</span>
                </div>
                <!-- Mobile menu button (can be wired up later) -->
                <button class="text-gray-500 hover:text-gray-600">
                    <i data-lucide="menu" class="h-6 w-6"></i>
                </button>
            </header>

            <!-- Scrollable Content -->
            <main class="flex-1 overflow-y-auto p-4 md:p-8">
                
                <!-- Page Header -->
                <header class="mb-8">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Dashboard</h1>
                    <p class="text-lg text-gray-600 mt-2">Upload your resume to get AI-powered feedback and job matches.</p>
                </header>

                <!-- This 'main' card is your existing application content -->
                <div class="bg-white rounded-lg shadow-xl p-6 md:p-8 w-full max-w-4xl mx-auto">
                    
                    <!-- Upload Section -->
                    <section id="upload-section">
                        <form id="resume-form" class="space-y-6">
                            <div>
                                <label for="file-upload" class="block text-sm font-medium text-gray-700 mb-2">Upload Resume:</label>
                                <div id="file-dropzone" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md transition-all duration-300 ease-in-out">
                                    <div class="space-y-1 text-center py-4">
                                        <i data-lucide="upload-cloud" class="mx-auto h-12 w-12 text-gray-400"></i>
                                        <div class="flex text-sm text-gray-600">
                                            <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                                                <span>Upload a file</span>
                                                <input id="file-upload" name="resume" type="file" class="sr-only" accept=".pdf,.txt">
                                            </label>
                                            <p class="pl-1">or drag and drop</p>
                                        </div>
                                        <p class="text-xs text-gray-500">PDF or TXT up to 10MB</p>
                                    </div>
                                </div>
                            </div>
                            <div id="file-info" class="text-sm text-gray-700 hidden">
                                <strong>Selected file:</strong> <span id="file-name"></span>
                            </div>
                            <div id="error-message" class="text-sm text-red-600 font-medium hidden"></div>
                            <div>
                                <button type="submit" id="analyze-button" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-300 ease-in-out" disabled>
                                    <i data-lucide="loader-2" id="spinner" class="spinner h-5 w-5 mr-2 hidden"></i>
                                    <span id="button-text">Analyze Resume</span>
                                </button>
                            </div>
                        </form>
                    </section>

                    <!-- Results Section -->
                    <section id="results-section" class="hidden mt-10">
                        
                        <!-- AI Summary Section -->
                        <div id="ai-summary-container" class="mb-8">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                                <i data-lucide="sparkles" class="h-6 w-6 mr-2 text-indigo-600"></i>
                                AI Professional Summary
                            </h2>
                            <div id="ai-summary-content" class="ai-content text-gray-700">
                                <p>Generating summary...</p>
                            </div>
                        </div>

                        <!-- Resume Skills -->
                        <div id="resume-skills-container" class="mb-8">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Skills Found in Your Resume</h2>
                            <div id="resume-skills-list" class="flex flex-wrap gap-2">
                                <p class="text-gray-500">No specific skills from our database were found.</p>
                            </div>
                        </div>

                        <!-- Top Matches -->
                        <div>
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Top Job Matches</h2>
                            
                            <!-- AI Match Explanation -->
                            <div id="ai-match-container" class="mb-6 hidden">
                                 <h3 class="text-lg font-semibold text-gray-700 mb-2 flex items-center">
                                    <i data-lucide="target" class="h-5 w-5 mr-2 text-green-600"></i>
                                    Why You're a Top Match
                                </h3>
                                <div id="ai-match-content" class="ai-content text-gray-700">
                                    <p>Generating explanation...</p>
                                </div>
                            </div>

                            <div id="job-list" class="space-y-4">
                                <!-- Job cards will be dynamically inserted here -->
                            </div>
                            <p id="no-jobs-message" class="text-gray-500 hidden">No matching jobs found.</p>
                        </div>
                        
                        <!-- Analyze Another Button -->
                        <div class="mt-8 text-center">
                            <button id="reset-button" class="py-2 px-6 border border-indigo-600 rounded-md shadow-sm text-sm font-medium text-indigo-600 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Analyze Another Resume
                            </button>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- 
        ALL YOUR EXISTING, WORKING JAVASCRIPT IS BELOW.
        NO CHANGES WERE MADE TO THE LOGIC.
    -->
    <script>
        // Immediately replace all `data-lucide` icons on the page (including sidebar)
        lucide.createIcons();

        // Initialize Markdown converter
        const converter = new showdown.Converter();

        // Get DOM elements
        const resumeForm = document.getElementById('resume-form');
        const fileUpload = document.getElementById('file-upload');
        const fileDropzone = document.getElementById('file-dropzone');
        const fileInfo = document.getElementById('file-info');
        const fileNameEl = document.getElementById('file-name'); 
        const analyzeButton = document.getElementById('analyze-button');
        const buttonText = document.getElementById('button-text');
        const spinner = document.getElementById('spinner');
        const errorMessage = document.getElementById('error-message');
        
        const uploadSection = document.getElementById('upload-section');
        const resultsSection = document.getElementById('results-section');
        
        // AI Element Selectors
        const aiSummaryContent = document.getElementById('ai-summary-content');
        const aiMatchContainer = document.getElementById('ai-match-container');
        const aiMatchContent = document.getElementById('ai-match-content');
        
        const resumeSkillsList = document.getElementById('resume-skills-list');
        const jobList = document.getElementById('job-list');
        const noJobsMessage = document.getElementById('no-jobs-message');
        const resetButton = document.getElementById('reset-button');
        
        let selectedFile = null;

        // --- File Input Handlers (Unchanged) ---
        function handleFileSelect(file) {
            if (file) {
                const fName = file.name.toLowerCase();
                if (!fName.endsWith('.pdf') && !fName.endsWith('.txt')) {
                    showError("Invalid file type. Please upload a PDF or TXT.");
                    fileUpload.value = ""; 
                    selectedFile = null;
                    analyzeButton.disabled = true;
                    return;
                }
                if (file.size > 10 * 1024 * 1024) { // 10MB limit
                    showError("File is too large. Maximum size is 10MB.");
                    fileUpload.value = "";
                    selectedFile = null;
                    analyzeButton.disabled = true;
                    return;
                }
                selectedFile = file;
                fileNameEl.textContent = file.name; 
                fileInfo.classList.remove('hidden');
                analyzeButton.disabled = false; 
                fileDropzone.classList.add('border-indigo-600');
                hideError();
            }
        }
        fileUpload.addEventListener('change', (e) => handleFileSelect(e.target.files[0]));
        fileDropzone.addEventListener('dragover', (e) => {
            e.preventDefault(); e.stopPropagation();
            fileDropzone.classList.add('border-indigo-600', 'bg-indigo-50');
        });
        fileDropzone.addEventListener('dragleave', (e) => {
            e.preventDefault(); e.stopPropagation();
            fileDropzone.classList.remove('border-indigo-600', 'bg-indigo-50');
        });
        fileDropzone.addEventListener('drop', (e) => {
            e.preventDefault(); e.stopPropagation();
            fileDropzone.classList.remove('border-indigo-600', 'bg-indigo-50');
            const file = e.dataTransfer.files[0];
            fileUpload.files = e.dataTransfer.files; 
            handleFileSelect(file);
        });

        // --- Form Submission Handler (Unchanged) ---
        resumeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!selectedFile) return;

            setLoading(true);
            hideError();
            
            // Reset AI content
            aiSummaryContent.innerHTML = '<p>Generating summary...</p>';
            aiMatchContent.innerHTML = '<p>Generating explanation...</p>';
            aiMatchContainer.classList.add('hidden');

            const formData = new FormData();
            formData.append('resume', selectedFile);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || `Server error: ${response.status}`);
                }
                
                displayResults(data);
                uploadSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');

            } catch (err) {
                console.error("Fetch Error:", err);
                if (err.name === 'SyntaxError') {
                    showError("An unexpected server error occurred. Check the server terminal for details.");
                } else {
                    showError(err.message);
                }
            } finally {
                setLoading(false);
            }
        });

       

        // --- UI Helper Functions (Unchanged) ---
        
        function displayResults(data) {



            
            // 1. Display AI Content
            aiSummaryContent.innerHTML = converter.makeHtml(data.ai_summary || "Could not generate AI summary.");
            if (data.ai_match_explanation) {
                aiMatchContent.innerHTML = converter.makeHtml(data.ai_match_explanation);
                aiMatchContainer.classList.remove('hidden');
            }

            // 2. Display Resume Skills
            resumeSkillsList.innerHTML = '';
            if (data.resume_skills && data.resume_skills.length > 0) {
                data.resume_skills.forEach(skill => {
                    const skillTag = document.createElement('span');
                    skillTag.className = 'px-3 py-1 bg-indigo-100 text-indigo-800 text-sm font-medium rounded-full';
                    skillTag.textContent = skill;
                    resumeSkillsList.appendChild(skillTag);
                });
            } else {
                resumeSkillsList.innerHTML = '<p class="text-gray-500">No specific skills from our database were found.</p>';
            }

            // 3. Display Job Matches
            jobList.innerHTML = '';
            if (data.jobs && data.jobs.length > 0) {
                noJobsMessage.classList.add('hidden');
                data.jobs.forEach(job => {
                    const jobCard = createJobCard(job);
                    jobList.appendChild(jobCard);
                });
            } else {
                noJobsMessage.classList.remove('hidden');
            }
            // Re-render icons after adding new elements
            lucide.createIcons();
        }

        function createJobCard(job) {
            const card = document.createElement('div');
            card.className = 'border border-gray-200 rounded-lg p-5 shadow-sm bg-white hover:shadow-md transition-shadow duration-300'; // Added hover effect

            const scorePercent = Math.round(job.score);
            const scoreColor = scorePercent > 80 ? 'text-green-600' : scorePercent > 60 ? 'text-yellow-600' : 'text-red-600';

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-semibold text-indigo-700">${job.title}</h3>
                        <p class="text-md text-gray-600">${job.company}</p>
                    </div>
                    <div class="text-right flex-shrink-0 ml-4">
                        <span class="text-xl font-bold ${scoreColor}">${scorePercent}%</span>
                        <p class="text-sm text-gray-500">Match</p>
                    </div>
                </div>
                ${(job.matched_skills.length > 0 || job.missing_skills.length > 0) ? `
                <div class="mt-4 pt-4 border-t border-gray-100">
                    ${job.matched_skills.length > 0 ? `
                    <div class="mb-2">
                        <h4 class="text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <i data-lucide="check-circle" class="h-4 w-4 mr-1 text-green-500"></i>
                            Skills You Have
                        </h4>
                        <div class="flex flex-wrap gap-1">
                            ${job.matched_skills.map(skill => `<span class="px-2 py-0.5 bg-green-100 text-green-800 text-xs font-medium rounded-full">${skill}</span>`).join('')}
                        </div>
                    </div>` : ''}
                    ${job.missing_skills.length > 0 ? `
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-1 flex items-center">
                            <i data-lucide="alert-circle" class="h-4 w-4 mr-1 text-yellow-500"></i>
                            Skills to Develop
                        </h4>
                        <div class="flex flex-wrap gap-1">
                            ${job.missing_skills.map(skill => `<span class="px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">${skill}</span>`).join('')}
                        </div>
                    </div>` : ''}
                </div>` : ''}
            `;
            return card;
        }
        


        function setLoading(isLoading) {
            if (isLoading) {
                analyzeButton.disabled = true;
                spinner.classList.remove('hidden');
                buttonText.textContent = 'Analyzing...';
            } else {
                analyzeButton.disabled = false;
                spinner.classList.add('hidden');
                buttonText.textContent = 'Analyze Resume';
            }
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // --- Reset Button Handler (Unchanged) ---
        resetButton.addEventListener('click', () => {
            selectedFile = null;
            fileUpload.value = ""; 
            
            resultsSection.classList.add('hidden');
            uploadSection.classList.remove('hidden');
            
            resumeForm.reset(); 
            fileInfo.classList.add('hidden');
            fileNameEl.textContent = ''; 
            analyzeButton.disabled = true;
            fileDropzone.classList.remove('border-indigo-600');
            hideError();
            jobList.innerHTML = '';
            resumeSkillsList.innerHTML = '';
            
            // Clear AI content
            aiSummaryContent.innerHTML = '';
            aiMatchContent.innerHTML = '';
        });
        
    </script>
</body>
</html>

